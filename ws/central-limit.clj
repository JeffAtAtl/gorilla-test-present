;; gorilla-repl.fileformat = 1

;; **
;;; # Central limit theorem
;;; 
;;; We're going to look at the CLT in this worksheet, and simulate its action. Be reminded that
;;; 
;;; $$ \sum_i u_i \overset{d}\to N $$
;;; 
;;; where @@u_i@@ is a uniformly distributed random variable.
;; **

;; @@
(ns central-limit
  (:use gorilla-plot.core)
  (:use gorilla-test.core)
  (:use clojure.repl)
  (:use clojure.pprint))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-nil'>nil</span>","value":"nil"}
;; <=

;; @@
(defn r [] (- (apply + (repeatedly 50 rand)) 25))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;central-limit/r</span>","value":"#'central-limit/r"}
;; <=

;; @@
(def data (repeatedly 1000 r))
;; @@
;; =>
;;; {"type":"html","content":"<span class='clj-var'>#&#x27;central-limit/data</span>","value":"#'central-limit/data"}
;; <=

;; **
;;; Let's compare the simulated data and the expected distribution.
;; **

;; @@
(compose
 (histogram data :bins 50 :normalise :probability-density)
 (plot #(gaussian % 2 0) [-10 10]))
;; @@
;; =>
;;; {"type":"vega","content":{"width":400,"height":247.2187957763672,"padding":{"bottom":20,"top":10,"right":10,"left":50},"scales":[{"name":"x","type":"linear","range":"width","zero":false,"domain":{"data":"004ff75b-6acf-491e-8b95-77bbd6c5ba18","field":"data.x"}},{"name":"y","type":"linear","range":"height","nice":true,"zero":false,"domain":{"data":"004ff75b-6acf-491e-8b95-77bbd6c5ba18","field":"data.y"}}],"axes":[{"type":"x","scale":"x"},{"type":"y","scale":"y"}],"data":[{"name":"004ff75b-6acf-491e-8b95-77bbd6c5ba18","values":[{"x":-9.470388286089424,"y":0},{"x":-9.148274204713344,"y":0.0031044901723264466},{"x":-8.826160123337264,"y":0.0},{"x":-8.504046041961184,"y":0.0},{"x":-8.181931960585104,"y":0.0},{"x":-7.859817879209024,"y":0.0},{"x":-7.537703797832945,"y":0.0},{"x":-7.215589716456866,"y":0.0031044901723264466},{"x":-6.893475635080787,"y":0.0},{"x":-6.571361553704707,"y":0.0031044901723264466},{"x":-6.249247472328628,"y":0.006208980344652893},{"x":-5.927133390952549,"y":0.0},{"x":-5.60501930957647,"y":0.0031044901723264466},{"x":-5.2829052282003905,"y":0.0031044901723264466},{"x":-4.960791146824311,"y":0.0},{"x":-4.638677065448232,"y":0.006208980344652893},{"x":-4.316562984072153,"y":0.00931347051697934},{"x":-3.9944489026960737,"y":0.01862694103395868},{"x":-3.6723348213199944,"y":0.034149391895590915},{"x":-3.3502207399439152,"y":0.05588082310187604},{"x":-3.028106658567836,"y":0.0465673525848967},{"x":-2.705992577191757,"y":0.10555266585909918},{"x":-2.3838784958156776,"y":0.08692572482514051},{"x":-2.0617644144395983,"y":0.0931347051697934},{"x":-1.739650333063519,"y":0.12728409706538432},{"x":-1.4175362516874395,"y":0.19558288085656614},{"x":-1.09542217031136,"y":0.14901552827166945},{"x":-0.7733080889352806,"y":0.14901552827166945},{"x":-0.45119400755920114,"y":0.19558288085656614},{"x":-0.1290799261831217,"y":0.17385144965028101},{"x":0.19303415519295775,"y":0.21420982189052482},{"x":0.5151482365690372,"y":0.1800604299949339},{"x":0.8372623179451166,"y":0.19868737102889258},{"x":1.159376399321196,"y":0.18316492016726035},{"x":1.4814904806972755,"y":0.1397020577546901},{"x":1.803604562073355,"y":0.13349307741003721},{"x":2.125718643449434,"y":0.14280654792701655},{"x":2.4478327248255134,"y":0.09623919534211985},{"x":2.7699468062015926,"y":0.10244817568677274},{"x":3.092060887577672,"y":0.06519429361885538},{"x":3.414174968953751,"y":0.0465673525848967},{"x":3.7362890503298303,"y":0.024835921378611573},{"x":4.0584031317059095,"y":0.034149391895590915},{"x":4.380517213081989,"y":0.021731431206285127},{"x":4.702631294458068,"y":0.015522450861632233},{"x":5.024745375834147,"y":0.006208980344652893},{"x":5.346859457210226,"y":0.00931347051697934},{"x":5.668973538586306,"y":0.00931347051697934},{"x":5.991087619962385,"y":0.0031044901723264466},{"x":6.313201701338464,"y":0.0031044901723264466},{"x":6.635315782714543,"y":0.0031044901723264466},{"x":6.9574298640906225,"y":0.0031044901723264466},{"x":7.279543945466702,"y":0}]},{"name":"c2a8489f-aaf5-4613-b0f9-450f0fb89bfa","values":[{"x":-10,"y":7.453306344157342E-7},{"x":-9.799999997019768,"y":1.2227136022020082E-6},{"x":-9.599999994039536,"y":1.9859008895787535E-6},{"x":-9.399999991059303,"y":3.1933568466554097E-6},{"x":-9.199999988079071,"y":5.083869442630077E-6},{"x":-8.999999985098839,"y":8.013059747248974E-6},{"x":-8.799999982118607,"y":1.2504301246871565E-5},{"x":-8.599999979138374,"y":1.9318683610927946E-5},{"x":-8.399999976158142,"y":2.9549673525896843E-5},{"x":-8.19999997317791,"y":4.474916120466938E-5},{"x":-7.999999970197678,"y":6.709252957952864E-5},{"x":-7.799999967217445,"y":9.959109066711276E-5},{"x":-7.599999964237213,"y":1.463604937211866E-4},{"x":-7.399999961256981,"y":2.129532625969202E-4},{"x":-7.199999958276749,"y":3.0676215890329826E-4},{"x":-6.999999955296516,"y":4.3749825786254407E-4},{"x":-6.799999952316284,"y":6.177431317230414E-4},{"x":-6.599999949336052,"y":8.635680737170301E-4},{"x":-6.39999994635582,"y":0.0011952046815864247},{"x":-6.1999999433755875,"y":0.0016377403466157404},{"x":-5.999999940395355,"y":0.002221799506292808},{"x":-5.799999937415123,"y":0.002984157484620092},{"x":-5.599999934434891,"y":0.003968219313121465},{"x":-5.3999999314546585,"y":0.005224282454218924},{"x":-5.199999928474426,"y":0.006809491580088464},{"x":-4.999999925494194,"y":0.008787387543070678},{"x":-4.799999922513962,"y":0.011226953610745277},{"x":-4.5999999195337296,"y":0.014201072062040727},{"x":-4.399999916553497,"y":0.017784325124320887},{"x":-4.199999913573265,"y":0.022050107061901632},{"x":-3.999999910593033,"y":0.027067059067306068},{"x":-3.7999999076128006,"y":0.032894894202544614},{"x":-3.5999999046325684,"y":0.03957974321387936},{"x":-3.399999901652336,"y":0.04714921925263572},{"x":-3.199999898672104,"y":0.0556074645983085},{"x":-2.9999998956918716,"y":0.06493049855125375},{"x":-2.7999998927116394,"y":0.07506222540759178},{"x":-2.599999889731407,"y":0.08591147779981703},{"x":-2.399999886751175,"y":0.09735045780688895},{"x":-2.1999998837709427,"y":0.10921489230961066},{"x":-1.9999998807907104,"y":0.12130613917293559},{"x":-1.7999998778104782,"y":0.13339536950647682},{"x":-1.599999874830246,"y":0.1452298146860898},{"x":-1.3999998718500137,"y":0.1565409146696238},{"x":-1.1999998688697815,"y":0.1670540488540041},{"x":-0.9999998658895493,"y":0.17649938643452168},{"x":-0.799999862909317,"y":0.18462327433935283},{"x":-0.5999998599290848,"y":0.1911995003838428},{"x":-0.39999985694885254,"y":0.19603973746572148},{"x":-0.1999998539686203,"y":0.19900249729156638},{"x":1.4901161193847656E-7,"y":0.19999999999999946},{"x":0.20000015199184418,"y":0.1990024943261981},{"x":0.4000001549720764,"y":0.19603973162328203},{"x":0.6000001579523087,"y":0.19119949183655915},{"x":0.8000001609325409,"y":0.1846232633349483},{"x":1.0000001639127731,"y":0.1764993732842929},{"x":1.2000001668930054,"y":0.1670540339182087},{"x":1.4000001698732376,"y":0.15654089834113458},{"x":1.6000001728534698,"y":0.14522979737334754},{"x":1.800000175833702,"y":0.1333953516167646},{"x":2.0000001788139343,"y":0.12130612109691333},{"x":2.2000001817941666,"y":0.109214874407896},{"x":2.400000184774399,"y":0.09735044039927186},{"x":2.600000187754631,"y":0.08591146115746827},{"x":2.8000001907348633,"y":0.07506220974839269},{"x":3.0000001937150955,"y":0.06493048403815777},{"x":3.2000001966953278,"y":0.055607451340457185},{"x":3.40000019967556,"y":0.04714920730880908},{"x":3.6000002026557922,"y":0.03957973259776622},{"x":3.8000002056360245,"y":0.03289488488927549},{"x":4.000000208616257,"y":0.02706705100069495},{"x":4.200000211596489,"y":0.02205010016188641},{"x":4.400000214576721,"y":0.017784319294165653},{"x":4.600000217556953,"y":0.014201067194954814},{"x":4.800000220537186,"y":0.011226949595674444},{"x":5.000000223517418,"y":0.008787384269514283},{"x":5.20000022649765,"y":0.006809488941886312},{"x":5.400000229477882,"y":0.0052242803523266925},{"x":5.600000232458115,"y":0.003968217657451668},{"x":5.800000235438347,"y":0.002984156195065413},{"x":6.000000238418579,"y":0.0022217985130712366},{"x":6.200000241398811,"y":0.001637739590084685},{"x":6.400000244379044,"y":0.0011952041116685484},{"x":6.600000247359276,"y":8.635676490676143E-4},{"x":6.800000250339508,"y":6.177428187500568E-4},{"x":7.00000025331974,"y":4.3749802968947785E-4},{"x":7.2000002562999725,"y":3.0676199434329435E-4},{"x":7.400000259280205,"y":2.1295314518666783E-4},{"x":7.600000262260437,"y":1.46360410845439E-4},{"x":7.800000265240669,"y":9.959103279023577E-5},{"x":8.000000268220901,"y":6.709248958927605E-5},{"x":8.200000271201134,"y":4.47491338652843E-5},{"x":8.400000274181366,"y":2.9549655032275533E-5},{"x":8.600000277161598,"y":1.9318671232486508E-5},{"x":8.80000028014183,"y":1.2504293048415349E-5},{"x":9.000000283122063,"y":8.013054374075417E-6},{"x":9.200000286102295,"y":5.083865957875547E-6},{"x":9.400000289082527,"y":3.193354610174078E-6},{"x":9.60000029206276,"y":1.9858994691522355E-6},{"x":9.800000295042992,"y":1.2227127094295497E-6}]}],"marks":[{"type":"line","from":{"data":"004ff75b-6acf-491e-8b95-77bbd6c5ba18"},"properties":{"enter":{"x":{"field":"data.x","scale":"x"},"y":{"field":"data.y","scale":"y"},"interpolate":{"value":"step-before"},"fill":{"value":"steelblue"},"fillOpacity":{"value":0.4},"stroke":{"value":"steelblue"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}},{"type":"line","from":{"data":"c2a8489f-aaf5-4613-b0f9-450f0fb89bfa"},"properties":{"enter":{"x":{"field":"data.x","scale":"x"},"y":{"field":"data.y","scale":"y"},"stroke":{"value":"#FF29D2"},"strokeWidth":{"value":2},"strokeOpacity":{"value":1}}}}]},"value":"#gorilla_repl.vega.VegaView{:content {:width 400, :height 247.2188, :padding {:bottom 20, :top 10, :right 10, :left 50}, :scales [{:name \"x\", :type \"linear\", :range \"width\", :zero false, :domain {:data \"004ff75b-6acf-491e-8b95-77bbd6c5ba18\", :field \"data.x\"}} {:name \"y\", :type \"linear\", :range \"height\", :nice true, :zero false, :domain {:data \"004ff75b-6acf-491e-8b95-77bbd6c5ba18\", :field \"data.y\"}}], :axes [{:type \"x\", :scale \"x\"} {:type \"y\", :scale \"y\"}], :data ({:name \"004ff75b-6acf-491e-8b95-77bbd6c5ba18\", :values ({:x -9.470388286089424, :y 0} {:x -9.148274204713344, :y 0.0031044901723264466} {:x -8.826160123337264, :y 0.0} {:x -8.504046041961184, :y 0.0} {:x -8.181931960585104, :y 0.0} {:x -7.859817879209024, :y 0.0} {:x -7.537703797832945, :y 0.0} {:x -7.215589716456866, :y 0.0031044901723264466} {:x -6.893475635080787, :y 0.0} {:x -6.571361553704707, :y 0.0031044901723264466} {:x -6.249247472328628, :y 0.006208980344652893} {:x -5.927133390952549, :y 0.0} {:x -5.60501930957647, :y 0.0031044901723264466} {:x -5.2829052282003905, :y 0.0031044901723264466} {:x -4.960791146824311, :y 0.0} {:x -4.638677065448232, :y 0.006208980344652893} {:x -4.316562984072153, :y 0.00931347051697934} {:x -3.9944489026960737, :y 0.01862694103395868} {:x -3.6723348213199944, :y 0.034149391895590915} {:x -3.3502207399439152, :y 0.05588082310187604} {:x -3.028106658567836, :y 0.0465673525848967} {:x -2.705992577191757, :y 0.10555266585909918} {:x -2.3838784958156776, :y 0.08692572482514051} {:x -2.0617644144395983, :y 0.0931347051697934} {:x -1.739650333063519, :y 0.12728409706538432} {:x -1.4175362516874395, :y 0.19558288085656614} {:x -1.09542217031136, :y 0.14901552827166945} {:x -0.7733080889352806, :y 0.14901552827166945} {:x -0.45119400755920114, :y 0.19558288085656614} {:x -0.1290799261831217, :y 0.17385144965028101} {:x 0.19303415519295775, :y 0.21420982189052482} {:x 0.5151482365690372, :y 0.1800604299949339} {:x 0.8372623179451166, :y 0.19868737102889258} {:x 1.159376399321196, :y 0.18316492016726035} {:x 1.4814904806972755, :y 0.1397020577546901} {:x 1.803604562073355, :y 0.13349307741003721} {:x 2.125718643449434, :y 0.14280654792701655} {:x 2.4478327248255134, :y 0.09623919534211985} {:x 2.7699468062015926, :y 0.10244817568677274} {:x 3.092060887577672, :y 0.06519429361885538} {:x 3.414174968953751, :y 0.0465673525848967} {:x 3.7362890503298303, :y 0.024835921378611573} {:x 4.0584031317059095, :y 0.034149391895590915} {:x 4.380517213081989, :y 0.021731431206285127} {:x 4.702631294458068, :y 0.015522450861632233} {:x 5.024745375834147, :y 0.006208980344652893} {:x 5.346859457210226, :y 0.00931347051697934} {:x 5.668973538586306, :y 0.00931347051697934} {:x 5.991087619962385, :y 0.0031044901723264466} {:x 6.313201701338464, :y 0.0031044901723264466} {:x 6.635315782714543, :y 0.0031044901723264466} {:x 6.9574298640906225, :y 0.0031044901723264466} {:x 7.279543945466702, :y 0})} {:name \"c2a8489f-aaf5-4613-b0f9-450f0fb89bfa\", :values ({:x -10, :y 7.453306344157342E-7} {:x -9.799999997019768, :y 1.2227136022020082E-6} {:x -9.599999994039536, :y 1.9859008895787535E-6} {:x -9.399999991059303, :y 3.1933568466554097E-6} {:x -9.199999988079071, :y 5.083869442630077E-6} {:x -8.999999985098839, :y 8.013059747248974E-6} {:x -8.799999982118607, :y 1.2504301246871565E-5} {:x -8.599999979138374, :y 1.9318683610927946E-5} {:x -8.399999976158142, :y 2.9549673525896843E-5} {:x -8.19999997317791, :y 4.474916120466938E-5} {:x -7.999999970197678, :y 6.709252957952864E-5} {:x -7.799999967217445, :y 9.959109066711276E-5} {:x -7.599999964237213, :y 1.463604937211866E-4} {:x -7.399999961256981, :y 2.129532625969202E-4} {:x -7.199999958276749, :y 3.0676215890329826E-4} {:x -6.999999955296516, :y 4.3749825786254407E-4} {:x -6.799999952316284, :y 6.177431317230414E-4} {:x -6.599999949336052, :y 8.635680737170301E-4} {:x -6.39999994635582, :y 0.0011952046815864247} {:x -6.1999999433755875, :y 0.0016377403466157404} {:x -5.999999940395355, :y 0.002221799506292808} {:x -5.799999937415123, :y 0.002984157484620092} {:x -5.599999934434891, :y 0.003968219313121465} {:x -5.3999999314546585, :y 0.005224282454218924} {:x -5.199999928474426, :y 0.006809491580088464} {:x -4.999999925494194, :y 0.008787387543070678} {:x -4.799999922513962, :y 0.011226953610745277} {:x -4.5999999195337296, :y 0.014201072062040727} {:x -4.399999916553497, :y 0.017784325124320887} {:x -4.199999913573265, :y 0.022050107061901632} {:x -3.999999910593033, :y 0.027067059067306068} {:x -3.7999999076128006, :y 0.032894894202544614} {:x -3.5999999046325684, :y 0.03957974321387936} {:x -3.399999901652336, :y 0.04714921925263572} {:x -3.199999898672104, :y 0.0556074645983085} {:x -2.9999998956918716, :y 0.06493049855125375} {:x -2.7999998927116394, :y 0.07506222540759178} {:x -2.599999889731407, :y 0.08591147779981703} {:x -2.399999886751175, :y 0.09735045780688895} {:x -2.1999998837709427, :y 0.10921489230961066} {:x -1.9999998807907104, :y 0.12130613917293559} {:x -1.7999998778104782, :y 0.13339536950647682} {:x -1.599999874830246, :y 0.1452298146860898} {:x -1.3999998718500137, :y 0.1565409146696238} {:x -1.1999998688697815, :y 0.1670540488540041} {:x -0.9999998658895493, :y 0.17649938643452168} {:x -0.799999862909317, :y 0.18462327433935283} {:x -0.5999998599290848, :y 0.1911995003838428} {:x -0.39999985694885254, :y 0.19603973746572148} {:x -0.1999998539686203, :y 0.19900249729156638} {:x 1.4901161193847656E-7, :y 0.19999999999999946} {:x 0.20000015199184418, :y 0.1990024943261981} {:x 0.4000001549720764, :y 0.19603973162328203} {:x 0.6000001579523087, :y 0.19119949183655915} {:x 0.8000001609325409, :y 0.1846232633349483} {:x 1.0000001639127731, :y 0.1764993732842929} {:x 1.2000001668930054, :y 0.1670540339182087} {:x 1.4000001698732376, :y 0.15654089834113458} {:x 1.6000001728534698, :y 0.14522979737334754} {:x 1.800000175833702, :y 0.1333953516167646} {:x 2.0000001788139343, :y 0.12130612109691333} {:x 2.2000001817941666, :y 0.109214874407896} {:x 2.400000184774399, :y 0.09735044039927186} {:x 2.600000187754631, :y 0.08591146115746827} {:x 2.8000001907348633, :y 0.07506220974839269} {:x 3.0000001937150955, :y 0.06493048403815777} {:x 3.2000001966953278, :y 0.055607451340457185} {:x 3.40000019967556, :y 0.04714920730880908} {:x 3.6000002026557922, :y 0.03957973259776622} {:x 3.8000002056360245, :y 0.03289488488927549} {:x 4.000000208616257, :y 0.02706705100069495} {:x 4.200000211596489, :y 0.02205010016188641} {:x 4.400000214576721, :y 0.017784319294165653} {:x 4.600000217556953, :y 0.014201067194954814} {:x 4.800000220537186, :y 0.011226949595674444} {:x 5.000000223517418, :y 0.008787384269514283} {:x 5.20000022649765, :y 0.006809488941886312} {:x 5.400000229477882, :y 0.0052242803523266925} {:x 5.600000232458115, :y 0.003968217657451668} {:x 5.800000235438347, :y 0.002984156195065413} {:x 6.000000238418579, :y 0.0022217985130712366} {:x 6.200000241398811, :y 0.001637739590084685} {:x 6.400000244379044, :y 0.0011952041116685484} {:x 6.600000247359276, :y 8.635676490676143E-4} {:x 6.800000250339508, :y 6.177428187500568E-4} {:x 7.00000025331974, :y 4.3749802968947785E-4} {:x 7.2000002562999725, :y 3.0676199434329435E-4} {:x 7.400000259280205, :y 2.1295314518666783E-4} {:x 7.600000262260437, :y 1.46360410845439E-4} {:x 7.800000265240669, :y 9.959103279023577E-5} {:x 8.000000268220901, :y 6.709248958927605E-5} {:x 8.200000271201134, :y 4.47491338652843E-5} {:x 8.400000274181366, :y 2.9549655032275533E-5} {:x 8.600000277161598, :y 1.9318671232486508E-5} {:x 8.80000028014183, :y 1.2504293048415349E-5} {:x 9.000000283122063, :y 8.013054374075417E-6} {:x 9.200000286102295, :y 5.083865957875547E-6} {:x 9.400000289082527, :y 3.193354610174078E-6} {:x 9.60000029206276, :y 1.9858994691522355E-6} {:x 9.800000295042992, :y 1.2227127094295497E-6})}), :marks ({:type \"line\", :from {:data \"004ff75b-6acf-491e-8b95-77bbd6c5ba18\"}, :properties {:enter {:x {:field \"data.x\", :scale \"x\"}, :y {:field \"data.y\", :scale \"y\"}, :interpolate {:value \"step-before\"}, :fill {:value \"steelblue\"}, :fillOpacity {:value 0.4}, :stroke {:value \"steelblue\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}} {:type \"line\", :from {:data \"c2a8489f-aaf5-4613-b0f9-450f0fb89bfa\"}, :properties {:enter {:x {:field \"data.x\", :scale \"x\"}, :y {:field \"data.y\", :scale \"y\"}, :stroke {:value \"#FF29D2\"}, :strokeWidth {:value 2}, :strokeOpacity {:value 1}}}})}}"}
;; <=

;; @@

;; @@
